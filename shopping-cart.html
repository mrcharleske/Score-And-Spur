<!doctype html>
<html lang="en">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Shopping Cart - Score &amp; Spar Foodstuffs</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
  <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
  <script src="/_sdk/data_sdk.js"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <style>
        body {
            box-sizing: border-box;
            font-family: 'Poppins', -apple-system, BlinkMacSystemFont, sans-serif;
        }
        
        .mobile-menu {
            transform: translateX(-100%);
            transition: transform 0.3s ease;
        }
        
        .mobile-menu.active {
            transform: translateX(0);
        }
        
        .whatsapp-float {
            position: fixed;
            width: 60px;
            height: 60px;
            bottom: 40px;
            right: 40px;
            background-color: #25d366;
            color: #FFF;
            border-radius: 50px;
            text-align: center;
            font-size: 30px;
            box-shadow: 2px 2px 3px #999;
            z-index: 100;
            animation: pulse 2s infinite;
        }
        
        .whatsapp-float:hover {
            background-color: #128c7e;
        }
        
        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(37, 211, 102, 0.7);
            }
            70% {
                box-shadow: 0 0 0 10px rgba(37, 211, 102, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(37, 211, 102, 0);
            }
        }
        
        .cart-item {
            transition: all 0.3s ease;
        }
        
        .cart-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }
        
        .quantity-btn {
            width: 36px;
            height: 36px;
            border: 2px solid #ea580c;
            background: white;
            color: #ea580c;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .quantity-btn:hover {
            background: #ea580c;
            color: white;
        }
        
        .quantity-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .quantity-btn:disabled:hover {
            background: white;
            color: #ea580c;
        }
        
        .loading-spinner {
            display: none;
            width: 20px;
            height: 20px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #ea580c;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .toast {
            position: fixed;
            top: 80px;
            right: 20px;
            background: #10b981;
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 1000;
            transform: translateX(100%);
            transition: transform 0.3s ease;
        }
        
        .toast.show {
            transform: translateX(0);
        }
        
        .toast.error {
            background: #ef4444;
        }
        
        .fallback-icon {
            width: 80px;
            height: 80px;
            background: linear-gradient(45deg, #f3f4f6, #e5e7eb);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            color: #9ca3af;
        }
        
        .checkout-form {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }
        
        .checkout-form.active {
            max-height: 1000px;
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
 </head>
 <body class="bg-orange-50"><!-- Navigation -->
  <nav class="bg-white shadow-lg fixed w-full top-0 z-50">
   <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex justify-between items-center h-16"><!-- Logo -->
     <div class="flex-shrink-0 flex items-center"><a href="index.html" class="text-2xl font-bold text-orange-600"> <i class="fas fa-utensils mr-2"></i>Score &amp; Spar </a>
     </div><!-- Desktop Navigation -->
     <div class="hidden md:block">
      <div class="ml-10 flex items-baseline space-x-4"><a href="index.html" class="text-gray-700 hover:text-orange-600 px-3 py-2 rounded-md text-sm font-medium transition-colors">Home</a> <a href="shop.html" class="text-gray-700 hover:text-orange-600 px-3 py-2 rounded-md text-sm font-medium transition-colors">Shop</a> <a href="about.html" class="text-gray-700 hover:text-orange-600 px-3 py-2 rounded-md text-sm font-medium transition-colors">About</a> <a href="contact.html" class="text-gray-700 hover:text-orange-600 px-3 py-2 rounded-md text-sm font-medium transition-colors">Contact</a> <a href="cart.html" class="bg-orange-600 text-white px-4 py-2 rounded-md text-sm font-medium hover:bg-orange-700 transition-colors"> <i class="fas fa-shopping-cart mr-1"></i>Cart (<span id="nav-cart-count">0</span>) </a>
      </div>
     </div><!-- Mobile menu button -->
     <div class="md:hidden"><button id="mobile-menu-btn" class="text-gray-700 hover:text-orange-600 focus:outline-none"> <i class="fas fa-bars text-xl"></i> </button>
     </div>
    </div>
   </div><!-- Mobile Navigation -->
   <div id="mobile-menu" class="mobile-menu md:hidden fixed inset-y-0 left-0 w-64 bg-white shadow-lg z-50">
    <div class="p-4">
     <div class="flex justify-between items-center mb-8">
      <div class="text-xl font-bold text-orange-600"><i class="fas fa-utensils mr-2"></i>Score &amp; Spar
      </div><button id="close-menu-btn" class="text-gray-700 hover:text-orange-600"> <i class="fas fa-times text-xl"></i> </button>
     </div>
     <div class="space-y-4"><a href="index.html" class="block text-gray-700 hover:text-orange-600 py-2 text-lg font-medium">Home</a> <a href="shop.html" class="block text-gray-700 hover:text-orange-600 py-2 text-lg font-medium">Shop</a> <a href="about.html" class="block text-gray-700 hover:text-orange-600 py-2 text-lg font-medium">About</a> <a href="contact.html" class="block text-gray-700 hover:text-orange-600 py-2 text-lg font-medium">Contact</a> <a href="cart.html" class="block bg-orange-600 text-white px-4 py-3 rounded-md text-lg font-medium hover:bg-orange-700 transition-colors"> <i class="fas fa-shopping-cart mr-2"></i>Cart (<span class="mobile-cart-count">0</span>) </a>
     </div>
    </div>
   </div>
  </nav><!-- WhatsApp Float Button --> <a href="https://wa.me/254710224263" target="_blank" rel="noopener noreferrer" class="whatsapp-float"> <i class="fab fa-whatsapp" style="margin-top: 16px;"></i> </a> <!-- Main Content -->
  <main class="pt-20 min-h-screen"><!-- Page Header -->
   <section class="bg-white py-8 border-b">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
     <div class="flex items-center justify-between">
      <div data-aos="fade-right">
       <h1 class="text-3xl md:text-4xl font-bold text-gray-900 mb-2">Your Shopping Cart</h1>
       <p class="text-gray-600">Review your items and proceed to checkout</p>
      </div>
      <div class="text-right" data-aos="fade-left">
       <div class="text-sm text-gray-500">
        Total Items
       </div>
       <div class="text-2xl font-bold text-orange-600" id="total-items">
        0
       </div>
      </div>
     </div>
    </div>
   </section><!-- Cart Content -->
   <section class="py-8">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
     <div class="grid grid-cols-1 lg:grid-cols-3 gap-8"><!-- Cart Items -->
      <div class="lg:col-span-2"><!-- Loading State -->
       <div id="loading-state" class="text-center py-12">
        <div class="loading-spinner mx-auto mb-4" style="display: block; width: 40px; height: 40px;"></div>
        <p class="text-gray-600">Loading your cart...</p>
       </div><!-- Empty Cart State -->
       <div id="empty-cart" class="text-center py-12 bg-white rounded-xl shadow-lg" style="display: none;">
        <div class="mb-6"><i class="fas fa-shopping-cart text-6xl text-gray-300"></i>
        </div>
        <h3 class="text-xl font-semibold text-gray-900 mb-2">Your cart is empty</h3>
        <p class="text-gray-600 mb-6">Looks like you haven't added any items to your cart yet.</p><a href="shop.html" class="bg-orange-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-orange-700 transition-colors"> Continue Shopping </a>
       </div><!-- Cart Items List -->
       <div id="cart-items" class="space-y-4" style="display: none;"><!-- Cart items will be dynamically inserted here -->
       </div><!-- Quick Add Items -->
       <div id="quick-add-section" class="mt-8 bg-white rounded-xl shadow-lg p-6" style="display: none;">
        <h3 class="text-lg font-semibold text-gray-900 mb-4">Quick Add Items</h3>
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4"><button onclick="addQuickItem('Fresh Red Apples', 350, 'fas fa-apple-alt')" class="flex items-center p-3 border border-gray-200 rounded-lg hover:border-orange-600 hover:bg-orange-50 transition-colors">
          <div class="w-12 h-12 bg-red-100 rounded-lg flex items-center justify-center mr-3"><i class="fas fa-apple-alt text-red-600"></i>
          </div>
          <div class="text-left">
           <div class="font-semibold text-gray-900">
            Fresh Red Apples
           </div>
           <div class="text-orange-600 font-bold">
            KSh 350
           </div>
          </div></button> <button onclick="addQuickItem('Fresh Bananas', 200, 'fas fa-apple-alt')" class="flex items-center p-3 border border-gray-200 rounded-lg hover:border-orange-600 hover:bg-orange-50 transition-colors">
          <div class="w-12 h-12 bg-yellow-100 rounded-lg flex items-center justify-center mr-3"><i class="fas fa-apple-alt text-yellow-600"></i>
          </div>
          <div class="text-left">
           <div class="font-semibold text-gray-900">
            Fresh Bananas
           </div>
           <div class="text-orange-600 font-bold">
            KSh 200
           </div>
          </div></button>
        </div>
       </div>
      </div><!-- Order Summary -->
      <div class="lg:col-span-1">
       <div class="bg-white rounded-xl shadow-lg p-6 sticky top-24" data-aos="fade-left">
        <h3 class="text-xl font-bold text-gray-900 mb-6">Order Summary</h3>
        <div class="space-y-4 mb-6">
         <div class="flex justify-between"><span class="text-gray-600">Subtotal</span> <span class="font-semibold">KSh <span id="subtotal">0</span></span>
         </div>
         <div class="flex justify-between"><span class="text-gray-600">Delivery Fee</span> <span class="font-semibold">KSh <span id="delivery-fee">200</span></span>
         </div>
         <div class="flex justify-between text-green-600"><span>Discount</span> <span class="font-semibold">-KSh <span id="discount">0</span></span>
         </div>
         <div class="border-t pt-4">
          <div class="flex justify-between text-lg font-bold"><span>Total</span> <span class="text-orange-600">KSh <span id="total-amount">0</span></span>
          </div>
         </div>
        </div><!-- Promo Code -->
        <div class="mb-6"><label class="block text-sm font-semibold text-gray-700 mb-2">Promo Code</label>
         <div class="flex"><input type="text" id="promo-code" placeholder="Enter code" class="flex-1 px-3 py-2 border border-gray-300 rounded-l-lg focus:outline-none focus:border-orange-600"> <button onclick="applyPromoCode()" class="bg-orange-600 text-white px-4 py-2 rounded-r-lg hover:bg-orange-700 transition-colors"> Apply </button>
         </div>
        </div><!-- Checkout Button --> <button id="checkout-btn" onclick="toggleCheckout()" class="w-full bg-orange-600 text-white py-3 px-6 rounded-lg text-lg font-semibold hover:bg-orange-700 transition-colors mb-4"> Proceed to Checkout </button> <a href="shop.html" class="block text-center text-orange-600 hover:text-orange-700 font-semibold"> Continue Shopping </a> <!-- Checkout Form -->
        <div id="checkout-form" class="checkout-form mt-6 pt-6 border-t">
         <h4 class="font-bold text-gray-900 mb-4">Delivery Information</h4>
         <form onsubmit="processOrder(event)" class="space-y-4">
          <div><label class="block text-sm font-semibold text-gray-700 mb-1">Full Name</label> <input type="text" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-orange-600" placeholder="Enter your full name">
          </div>
          <div><label class="block text-sm font-semibold text-gray-700 mb-1">Phone Number</label> <input type="tel" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-orange-600" placeholder="+254 700 000 000">
          </div>
          <div><label class="block text-sm font-semibold text-gray-700 mb-1">Delivery Address</label> <textarea required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-orange-600" rows="3" placeholder="Enter your complete address"></textarea>
          </div>
          <div><label class="block text-sm font-semibold text-gray-700 mb-1">Payment Method</label> <select required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-orange-600"> <option value="">Select payment method</option> <option value="mpesa">M-Pesa</option> <option value="cash">Cash on Delivery</option> <option value="bank">Bank Transfer</option> </select>
          </div><button type="submit" class="w-full bg-green-600 text-white py-3 px-6 rounded-lg font-semibold hover:bg-green-700 transition-colors"> <i class="fas fa-check mr-2"></i>Place Order </button>
         </form>
        </div>
       </div>
      </div>
     </div>
    </div>
   </section>
  </main><!-- Footer -->
  <footer class="bg-gray-900 text-white py-12">
   <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
     <div>
      <div class="text-2xl font-bold text-orange-400 mb-4"><i class="fas fa-utensils mr-2"></i>Score &amp; Spar
      </div>
      <p class="text-gray-400 mb-4">Your trusted partner for fresh, quality foodstuffs and groceries in Kenya.</p>
      <div class="flex space-x-4"><a href="https://wa.me/254710224263" target="_blank" rel="noopener noreferrer" class="text-green-400 hover:text-green-300"> <i class="fab fa-whatsapp text-xl"></i> </a> <a href="tel:+254710224263" class="text-blue-400 hover:text-blue-300"> <i class="fas fa-phone text-xl"></i> </a>
      </div>
     </div>
     <div>
      <h3 class="text-lg font-semibold mb-4">Quick Links</h3>
      <ul class="space-y-2">
       <li><a href="index.html" class="text-gray-400 hover:text-white transition-colors">Home</a></li>
       <li><a href="shop.html" class="text-gray-400 hover:text-white transition-colors">Shop</a></li>
       <li><a href="about.html" class="text-gray-400 hover:text-white transition-colors">About</a></li>
       <li><a href="contact.html" class="text-gray-400 hover:text-white transition-colors">Contact</a></li>
      </ul>
     </div>
     <div>
      <h3 class="text-lg font-semibold mb-4">Categories</h3>
      <ul class="space-y-2">
       <li><a href="shop.html" class="text-gray-400 hover:text-white transition-colors">Fresh Produce</a></li>
       <li><a href="shop.html" class="text-gray-400 hover:text-white transition-colors">Bakery Items</a></li>
       <li><a href="shop.html" class="text-gray-400 hover:text-white transition-colors">Meat &amp; Poultry</a></li>
       <li><a href="shop.html" class="text-gray-400 hover:text-white transition-colors">Dairy Products</a></li>
      </ul>
     </div>
     <div>
      <h3 class="text-lg font-semibold mb-4">Contact Info</h3>
      <div class="space-y-2 text-gray-400">
       <p><i class="fas fa-phone mr-2"></i>+254 710 224 263</p>
       <p><i class="fab fa-whatsapp mr-2"></i>WhatsApp Available</p>
       <p><i class="fas fa-map-marker-alt mr-2"></i>Kenya</p>
       <p><i class="fas fa-clock mr-2"></i>Mon-Sun: 6AM-10PM</p>
      </div>
     </div>
    </div>
    <div class="border-t border-gray-800 mt-8 pt-8 text-center">
     <p class="text-gray-400">Â© 2024 Score &amp; Spar Foodstuffs. All rights reserved. Fresh food, happy families.</p>
    </div>
   </div>
  </footer>
  <script>
        // Global variables
        let cartItems = [];
        let isLoading = false;

        // Mobile menu functionality
        const mobileMenuBtn = document.getElementById('mobile-menu-btn');
        const mobileMenu = document.getElementById('mobile-menu');
        const closeMenuBtn = document.getElementById('close-menu-btn');

        mobileMenuBtn.addEventListener('click', () => {
            mobileMenu.classList.add('active');
        });

        closeMenuBtn.addEventListener('click', () => {
            mobileMenu.classList.remove('active');
        });

        // Close mobile menu when clicking outside
        document.addEventListener('click', (e) => {
            if (!mobileMenu.contains(e.target) && !mobileMenuBtn.contains(e.target)) {
                mobileMenu.classList.remove('active');
            }
        });

        // Initialize AOS animations
        AOS.init({
            duration: 1000,
            once: true,
            offset: 100
        });

        // Data SDK Handler
        const dataHandler = {
            onDataChanged(data) {
                cartItems = data || [];
                renderCartItems();
                updateCartSummary();
                updateCartCount();
            }
        };

        // Initialize Data SDK
        async function initializeDataSDK() {
            if (window.dataSdk) {
                const result = await window.dataSdk.init(dataHandler);
                if (!result.isOk) {
                    console.error('Failed to initialize Data SDK');
                    showToast('Failed to load cart data', 'error');
                }
            }
        }

        // Show loading state
        function showLoading() {
            document.getElementById('loading-state').style.display = 'block';
            document.getElementById('empty-cart').style.display = 'none';
            document.getElementById('cart-items').style.display = 'none';
            document.getElementById('quick-add-section').style.display = 'none';
        }

        // Hide loading state
        function hideLoading() {
            document.getElementById('loading-state').style.display = 'none';
        }

        // Render cart items
        function renderCartItems() {
            hideLoading();
            
            const cartItemsContainer = document.getElementById('cart-items');
            const emptyCartContainer = document.getElementById('empty-cart');
            const quickAddSection = document.getElementById('quick-add-section');

            if (cartItems.length === 0) {
                cartItemsContainer.style.display = 'none';
                quickAddSection.style.display = 'block';
                emptyCartContainer.style.display = 'block';
                return;
            }

            emptyCartContainer.style.display = 'none';
            quickAddSection.style.display = 'block';
            cartItemsContainer.style.display = 'block';
            cartItemsContainer.innerHTML = '';

            cartItems.forEach(item => {
                const cartItemElement = createCartItemElement(item);
                cartItemsContainer.appendChild(cartItemElement);
            });
        }

        // Create cart item element
        function createCartItemElement(item) {
            const div = document.createElement('div');
            div.className = 'cart-item bg-white rounded-xl shadow-lg p-6';
            div.innerHTML = `
                <div class="flex items-center space-x-4">
                    <div class="fallback-icon flex-shrink-0">
                        <i class="${item.image || 'fas fa-apple-alt'}"></i>
                    </div>
                    <div class="flex-1">
                        <h3 class="font-bold text-gray-900 text-lg">${item.name}</h3>
                        <p class="text-gray-600">${item.category || 'Fresh Produce'}</p>
                        <div class="flex items-center mt-2">
                            <span class="text-orange-600 font-bold text-lg">KSh ${item.price.toLocaleString()}</span>
                            <span class="text-gray-500 ml-2">per unit</span>
                        </div>
                    </div>
                    <div class="flex items-center space-x-3">
                        <button onclick="updateQuantity('${item.__backendId}', ${item.quantity - 1})" 
                                class="quantity-btn" ${item.quantity <= 1 ? 'disabled' : ''}>
                            -
                        </button>
                        <span class="w-12 text-center font-semibold text-lg">${item.quantity}</span>
                        <button onclick="updateQuantity('${item.__backendId}', ${item.quantity + 1})" 
                                class="quantity-btn">
                            +
                        </button>
                    </div>
                    <div class="text-right">
                        <div class="font-bold text-xl text-gray-900">KSh ${item.total.toLocaleString()}</div>
                        <button onclick="removeItem('${item.__backendId}')" 
                                class="text-red-600 hover:text-red-700 mt-2">
                            <i class="fas fa-trash mr-1"></i>Remove
                        </button>
                    </div>
                </div>
            `;
            return div;
        }

        // Update quantity
        async function updateQuantity(itemId, newQuantity) {
            if (newQuantity < 1) return;
            
            const item = cartItems.find(item => item.__backendId === itemId);
            if (!item) return;

            showLoading();
            
            const updatedItem = {
                ...item,
                quantity: newQuantity,
                total: item.price * newQuantity
            };

            const result = await window.dataSdk.update(updatedItem);
            if (!result.isOk) {
                hideLoading();
                showToast('Failed to update quantity', 'error');
            }
        }

        // Remove item
        async function removeItem(itemId) {
            const item = cartItems.find(item => item.__backendId === itemId);
            if (!item) return;

            showLoading();
            
            const result = await window.dataSdk.delete(item);
            if (result.isOk) {
                showToast('Item removed from cart');
            } else {
                hideLoading();
                showToast('Failed to remove item', 'error');
            }
        }

        // Add quick item
        async function addQuickItem(name, price, icon) {
            if (cartItems.length >= 999) {
                showToast('Maximum limit of 999 items reached. Please remove some items first.', 'error');
                return;
            }

            showLoading();
            
            const existingItem = cartItems.find(item => item.name === name);
            
            if (existingItem) {
                await updateQuantity(existingItem.__backendId, existingItem.quantity + 1);
            } else {
                const newItem = {
                    id: Date.now().toString(),
                    name: name,
                    price: price,
                    quantity: 1,
                    image: icon,
                    category: 'Fresh Produce',
                    total: price,
                    dateAdded: new Date().toISOString()
                };

                const result = await window.dataSdk.create(newItem);
                if (result.isOk) {
                    showToast(`${name} added to cart`);
                } else {
                    hideLoading();
                    showToast('Failed to add item to cart', 'error');
                }
            }
        }

        // Update cart summary
        function updateCartSummary() {
            const subtotal = cartItems.reduce((sum, item) => sum + item.total, 0);
            const deliveryFee = subtotal >= 2000 ? 0 : 200;
            const discount = 0; // Can be calculated based on promo codes
            const total = subtotal + deliveryFee - discount;

            document.getElementById('subtotal').textContent = subtotal.toLocaleString();
            document.getElementById('delivery-fee').textContent = deliveryFee.toLocaleString();
            document.getElementById('discount').textContent = discount.toLocaleString();
            document.getElementById('total-amount').textContent = total.toLocaleString();
            
            // Update delivery fee text
            const deliveryElement = document.getElementById('delivery-fee').parentElement;
            if (deliveryFee === 0) {
                deliveryElement.innerHTML = '<span class="text-green-600">Delivery Fee</span><span class="font-semibold text-green-600">FREE</span>';
            } else {
                deliveryElement.innerHTML = '<span class="text-gray-600">Delivery Fee</span><span class="font-semibold">KSh <span id="delivery-fee">200</span></span>';
            }
        }

        // Update cart count
        function updateCartCount() {
            const totalItems = cartItems.reduce((sum, item) => sum + item.quantity, 0);
            document.getElementById('nav-cart-count').textContent = totalItems;
            document.querySelector('.mobile-cart-count').textContent = totalItems;
            document.getElementById('total-items').textContent = totalItems;
        }

        // Apply promo code
        function applyPromoCode() {
            const promoCode = document.getElementById('promo-code').value.trim().toUpperCase();
            
            if (promoCode === 'FRESH10') {
                showToast('Promo code applied! 10% discount');
                // Update discount calculation
                updateCartSummary();
            } else if (promoCode === '') {
                showToast('Please enter a promo code', 'error');
            } else {
                showToast('Invalid promo code', 'error');
            }
        }

        // Toggle checkout form
        function toggleCheckout() {
            const checkoutForm = document.getElementById('checkout-form');
            const checkoutBtn = document.getElementById('checkout-btn');
            
            if (cartItems.length === 0) {
                showToast('Your cart is empty', 'error');
                return;
            }
            
            checkoutForm.classList.toggle('active');
            
            if (checkoutForm.classList.contains('active')) {
                checkoutBtn.textContent = 'Hide Checkout Form';
            } else {
                checkoutBtn.textContent = 'Proceed to Checkout';
            }
        }

        // Process order
        function processOrder(event) {
            event.preventDefault();
            
            const formData = new FormData(event.target);
            const orderData = {
                items: cartItems,
                customer: {
                    name: formData.get('name'),
                    phone: formData.get('phone'),
                    address: formData.get('address'),
                    paymentMethod: formData.get('paymentMethod')
                },
                total: document.getElementById('total-amount').textContent,
                orderDate: new Date().toISOString()
            };
            
            // Simulate order processing
            showToast('Order placed successfully! We will contact you shortly.');
            
            // Clear cart after successful order
            setTimeout(async () => {
                for (const item of cartItems) {
                    await window.dataSdk.delete(item);
                }
            }, 2000);
            
            // Reset checkout form
            document.getElementById('checkout-form').classList.remove('active');
            document.getElementById('checkout-btn').textContent = 'Proceed to Checkout';
        }

        // Show toast notification
        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `<i class="fas fa-${type === 'error' ? 'exclamation-circle' : 'check'} mr-2"></i>${message}`;
            
            document.body.appendChild(toast);
            
            setTimeout(() => toast.classList.add('show'), 100);
            
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => {
                    if (document.body.contains(toast)) {
                        document.body.removeChild(toast);
                    }
                }, 300);
            }, 3000);
        }

        // Element SDK Configuration
        const defaultConfig = {
            page_title: "Your Shopping Cart",
            checkout_button_text: "Proceed to Checkout",
            continue_shopping_text: "Continue Shopping",
            empty_cart_message: "Your cart is empty",
            primary_color: "#ea580c",
            secondary_color: "#ffffff",
            text_color: "#1f2937",
            accent_color: "#16a34a",
            background_color: "#fff7ed",
            font_family: "Poppins",
            font_size: 16
        };

        async function onConfigChange(config) {
            // Update page title
            const pageTitle = document.querySelector('h1');
            if (pageTitle) {
                pageTitle.textContent = config.page_title || defaultConfig.page_title;
            }
            
            // Update checkout button text
            const checkoutBtn = document.getElementById('checkout-btn');
            if (checkoutBtn && !checkoutBtn.textContent.includes('Hide')) {
                checkoutBtn.textContent = config.checkout_button_text || defaultConfig.checkout_button_text;
            }
            
            // Update continue shopping text
            const continueShoppingLinks = document.querySelectorAll('a[href="shop.html"]');
            continueShoppingLinks.forEach(link => {
                if (link.textContent.includes('Continue Shopping')) {
                    link.textContent = config.continue_shopping_text || defaultConfig.continue_shopping_text;
                }
            });
            
            // Update empty cart message
            const emptyCartMessage = document.querySelector('#empty-cart h3');
            if (emptyCartMessage) {
                emptyCartMessage.textContent = config.empty_cart_message || defaultConfig.empty_cart_message;
            }
            
            // Apply colors
            const backgroundColor = config.background_color || defaultConfig.background_color;
            document.body.style.backgroundColor = backgroundColor;
            
            // Apply font settings
            const customFont = config.font_family || defaultConfig.font_family;
            const baseSize = config.font_size || defaultConfig.font_size;
            
            document.body.style.fontFamily = `${customFont}, -apple-system, BlinkMacSystemFont, sans-serif`;
            document.body.style.fontSize = `${baseSize}px`;
            
            // Scale headings proportionally
            const headings = document.querySelectorAll('h1, h2, h3, h4');
            headings.forEach(heading => {
                if (heading.tagName === 'H1') {
                    heading.style.fontSize = `${baseSize * 2.5}px`;
                } else if (heading.tagName === 'H2') {
                    heading.style.fontSize = `${baseSize * 2}px`;
                } else if (heading.tagName === 'H3') {
                    heading.style.fontSize = `${baseSize * 1.5}px`;
                } else if (heading.tagName === 'H4') {
                    heading.style.fontSize = `${baseSize * 1.25}px`;
                }
            });
        }

        function mapToCapabilities(config) {
            return {
                recolorables: [
                    {
                        get: () => config.primary_color || defaultConfig.primary_color,
                        set: (value) => {
                            config.primary_color = value;
                            if (window.elementSdk) {
                                window.elementSdk.setConfig({ primary_color: value });
                            }
                        }
                    },
                    {
                        get: () => config.secondary_color || defaultConfig.secondary_color,
                        set: (value) => {
                            config.secondary_color = value;
                            if (window.elementSdk) {
                                window.elementSdk.setConfig({ secondary_color: value });
                            }
                        }
                    },
                    {
                        get: () => config.text_color || defaultConfig.text_color,
                        set: (value) => {
                            config.text_color = value;
                            if (window.elementSdk) {
                                window.elementSdk.setConfig({ text_color: value });
                            }
                        }
                    },
                    {
                        get: () => config.accent_color || defaultConfig.accent_color,
                        set: (value) => {
                            config.accent_color = value;
                            if (window.elementSdk) {
                                window.elementSdk.setConfig({ accent_color: value });
                            }
                        }
                    },
                    {
                        get: () => config.background_color || defaultConfig.background_color,
                        set: (value) => {
                            config.background_color = value;
                            if (window.elementSdk) {
                                window.elementSdk.setConfig({ background_color: value });
                            }
                        }
                    }
                ],
                borderables: [],
                fontEditable: {
                    get: () => config.font_family || defaultConfig.font_family,
                    set: (value) => {
                        config.font_family = value;
                        if (window.elementSdk) {
                            window.elementSdk.setConfig({ font_family: value });
                        }
                    }
                },
                fontSizeable: {
                    get: () => config.font_size || defaultConfig.font_size,
                    set: (value) => {
                        config.font_size = value;
                        if (window.elementSdk) {
                            window.elementSdk.setConfig({ font_size: value });
                        }
                    }
                }
            };
        }

        function mapToEditPanelValues(config) {
            return new Map([
                ["page_title", config.page_title || defaultConfig.page_title],
                ["checkout_button_text", config.checkout_button_text || defaultConfig.checkout_button_text],
                ["continue_shopping_text", config.continue_shopping_text || defaultConfig.continue_shopping_text],
                ["empty_cart_message", config.empty_cart_message || defaultConfig.empty_cart_message]
            ]);
        }

        // Initialize everything
        document.addEventListener('DOMContentLoaded', async () => {
            showLoading();
            await initializeDataSDK();
            
            // Initialize Element SDK
            if (window.elementSdk) {
                window.elementSdk.init({
                    defaultConfig,
                    onConfigChange,
                    mapToCapabilities,
                    mapToEditPanelValues
                });
            }
        });
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'99948502573f50d4',t:'MTc2MjI2MzU4OC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
